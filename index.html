<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECMW Global Fleet Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ALL OPTIONS FROM YOUR OLD CONSTANTS ---
        const ENTITIES = ["ECM4", "ECM7", "ECM10"];
        const STATUSES = ["Repo IPs", "Verification", "ADD contact", "Repoting", "EMPTY", "LOGING", "Hold", "DOWN"];
        const PLATFORMS = ["ECM_APP", "iMACROS"];
        const TEAMS = ["A", "B", "C"];

        // --- YOUR COMPLETE DATASET ---
        const INITIAL_DATA = [
            {"id":"1","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"External","pack":"Pack1","dataSeeds":"oui","server":"194.163.144.27","disk":"externe","rdps":"repo","password":"LABO@0000","interval":"1-3999","browser":"Chrome","status":"Repoting","countProfiles":"3999","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"2","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"External","pack":"Pack2","dataSeeds":"oui","server":"185.216.75.117","disk":"externe","rdps":"repo","password":"LABO@0000","interval":"1-5000","browser":"Chrome","status":"Repo IPs","countProfiles":"5000","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"3","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"External","pack":"Pack3","dataSeeds":"non","server":"66.94.120.85","disk":"externe","rdps":"repo","password":"LABO@0000","interval":"1-3078","browser":"Chrome","status":"Repo IPs","countProfiles":"3078","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"4","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"External","pack":"Pack4","dataSeeds":"oui","server":"194.163.130.102","disk":"externe","rdps":"repo","password":"LABO@0000","interval":"1-3000","browser":"Chrome","status":"Repoting","countProfiles":"3000","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"5","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack5","dataSeeds":"non","server":"4","disk":"E","rdps":"ECM4_Gmail_1","password":"Password@1.","interval":"1-5000","browser":"Chrome","status":"Repoting","countProfiles":"3746","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"6","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack6","dataSeeds":"non","server":"4","disk":"E","rdps":"ECM4_Gmail_2","password":"Password@2.","interval":"5001-10000","browser":"Chrome","status":"Verification","countProfiles":"3791","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"7","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack7","dataSeeds":"non","server":"4","disk":"E","rdps":"ECM4_Gmail_3","password":"Password@3.","interval":"10001-15000","browser":"Chrome","status":"Repo IPs","countProfiles":"3428","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"8","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack8","dataSeeds":"non","server":"3","disk":"G","rdps":"ECM4_Gmail_1","password":"Password@1.","interval":"15001-20000","browser":"Chrome","status":"Repoting","countProfiles":"2560","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"9","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack9","dataSeeds":"non","server":"3","disk":"G","rdps":"ECM4_Gmail_2","password":"Password@2.","interval":"20001-25000","browser":"Chrome","status":"Repo IPs","countProfiles":"3025","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"10","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack10","dataSeeds":"non","server":"4","disk":"F","rdps":"ECM4_Gmail_4","password":"Password@4.","interval":"28793-30391","browser":"Chromium","status":"ADD contact","countProfiles":"774","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"11","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack11","dataSeeds":"non","server":"7","disk":"H","rdps":"ECM4_Gmail_1","password":"tHp**DHpQK7g","interval":"31152-37181","browser":"webview","status":"Repoting","countProfiles":"4251","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"12","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack12","dataSeeds":"non","server":"7","disk":"F","rdps":"ECM4_Gmail_2","password":"(DC%c(D#V5f*","interval":"37182-39179","browser":"webview","status":"Verification","countProfiles":"552","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"13","entity":"ECM4","entityProd":"ECM4","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack13","dataSeeds":"non","server":"3","disk":"I","rdps":"ECM4_gmail_5","password":"Password@5.","interval":"40000-42000","browser":"webview","status":"Repoting","countProfiles":"1989","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"14","entity":"ECM4","entityProd":"ECM4","platform":"iMACROS","team":"A","localExternal":"External","pack":"Pack14","dataSeeds":"non","server":"144.126.130.165","disk":"externe","rdps":"repo4","password":"ECM4@6666","interval":"85--1782","browser":"palemoon","status":"Repo IPs","countProfiles":"1711","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"15","entity":"ECM4","entityProd":"ECM4","platform":"iMACROS","team":"A","localExternal":"External","pack":"Pack15","dataSeeds":"non","server":"194.163.144.27","disk":"externe","rdps":"repo1","password":"ECM4@6666","interval":"3--13753","browser":"palemoon","status":"Repo IPs","countProfiles":"1914","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"23","entity":"ECM7","entityProd":"ECM5","platform":"ECM_APP","team":"A","localExternal":"Local","pack":"Pack23","dataSeeds":"oui","server":"4","disk":"D","rdps":"ECM5_gmail_1","password":"Njs-.;:pg,rb6Xyw5LW49/","interval":"1-5000","browser":"Chrome","status":"Repoting","countProfiles":"3895","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"45","entity":"ECM7","entityProd":"ECM3","platform":"ECM_APP","team":"B","localExternal":"Local","pack":"Pack45","dataSeeds":"non","server":"1","disk":"D","rdps":"ecm3_gmail_1","password":"Password@1.","interval":"1-5000","browser":"Chrome","status":"Repoting","countProfiles":"2969","backup":"Non","totalSeedsOk":"","notes":""},
            {"id":"80","entity":"ECM10","entityProd":"ECM2","platform":"ECM_APP","team":"B","localExternal":"External","pack":"Pack80","dataSeeds":"non","server":"70.36.107.56","disk":"externe","rdps":"admin","password":"ECM2_uC84","interval":"1---6000","browser":"Chrome","status":"ADD contact","countProfiles":"5751","backup":"Non","totalSeedsOk":"","notes":""}
        ];

        function App() {
            const [packs, setPacks] = useState(() => {
                const saved = localStorage.getItem('ecmw_master_store');
                return saved ? JSON.parse(saved) : INITIAL_DATA;
            });

            const [filters, setFilters] = useState({ search: '', entity: '', status: '' });
            const [modal, setModal] = useState({ open: false, data: null });

            useEffect(() => {
                localStorage.setItem('ecmw_master_store', JSON.stringify(packs));
            }, [packs]);

            const filteredPacks = useMemo(() => {
                return packs.filter(p => {
                    const matchesSearch = Object.values(p).some(v => String(v).toLowerCase().includes(filters.search.toLowerCase()));
                    const matchesEntity = !filters.entity || p.entity === filters.entity;
                    const matchesStatus = !filters.status || p.status === filters.status;
                    return matchesSearch && matchesEntity && matchesStatus;
                });
            }, [packs, filters]);

            const stats = useMemo(() => ({
                count: filteredPacks.length,
                profiles: filteredPacks.reduce((acc, p) => acc + (parseInt(p.countProfiles) || 0), 0),
                down: filteredPacks.filter(p => p.status === 'DOWN' || p.status === 'Hold').length
            }), [filteredPacks]);

            const handleSave = (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const newData = Object.fromEntries(fd.entries());
                if (modal.data?.id) {
                    setPacks(prev => prev.map(p => p.id === modal.data.id ? {...p, ...newData} : p));
                } else {
                    setPacks(prev => [{...newData, id: Date.now().toString()}, ...prev]);
                }
                setModal({ open: false, data: null });
            };

            const exportCSV = () => {
                const headers = Object.keys(packs[0]).join(",");
                const rows = filteredPacks.map(p => Object.values(p).join(",")).join("\n");
                const blob = new Blob([[headers, rows].join("\n")], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ecmw_export_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            return (
                <div className="flex flex-col min-h-screen pb-12">
                    {/* NAVBAR */}
                    <nav className="glass sticky top-0 z-30 border-b border-slate-200 px-6 py-4 flex justify-between items-center">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                                <i className="fas fa-satellite-dish"></i>
                            </div>
                            <div>
                                <h1 className="text-xl font-black text-slate-800 uppercase leading-none">ECMW GLOBAL</h1>
                                <span className="text-[10px] font-bold text-blue-600 uppercase tracking-[0.2em]">Fleet Management</span>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={exportCSV} className="hidden md:flex items-center gap-2 px-4 py-2 text-slate-600 font-bold text-sm hover:bg-slate-100 rounded-xl transition-all">
                                <i className="fas fa-download"></i> Export
                            </button>
                            <button onClick={() => setModal({ open: true, data: null })} className="bg-slate-900 text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-md hover:bg-slate-800 active:scale-95 transition-all">
                                <i className="fas fa-plus mr-2"></i> Add Pack
                            </button>
                        </div>
                    </nav>

                    <main className="max-w-[1600px] mx-auto w-full p-6 space-y-6">
                        {/* STATS CARDS */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {[
                                { label: 'Total Packs', val: stats.count, icon: 'fa-box', col: 'text-blue-600', bg: 'bg-blue-50' },
                                { label: 'Total Profiles', val: stats.profiles.toLocaleString(), icon: 'fa-users', col: 'text-indigo-600', bg: 'bg-indigo-50' },
                                { label: 'Issues/Offline', val: stats.down, icon: 'fa-exclamation-triangle', col: 'text-rose-600', bg: 'bg-rose-50' }
                            ].map((s, i) => (
                                <div key={i} className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex items-center gap-5">
                                    <div className={`w-14 h-14 ${s.bg} ${s.col} rounded-2xl flex items-center justify-center text-xl shadow-inner`}>
                                        <i className={`fas ${s.icon}`}></i>
                                    </div>
                                    <div>
                                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{s.label}</p>
                                        <p className="text-3xl font-black text-slate-800">{s.val}</p>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* FILTER BAR */}
                        <div className="bg-white p-3 rounded-2xl border border-slate-200 shadow-sm flex flex-wrap gap-3">
                            <div className="flex-1 min-w-[300px] relative">
                                <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input 
                                    className="w-full pl-11 pr-4 py-3 bg-slate-50 border-none rounded-xl outline-none focus:ring-2 focus:ring-blue-500 font-medium transition-all"
                                    placeholder="Search everything..."
                                    value={filters.search}
                                    onChange={e => setFilters({...filters, search: e.target.value})}
                                />
                            </div>
                            <select className="px-4 py-3 bg-slate-50 border-none rounded-xl font-bold text-sm outline-none" 
                                value={filters.entity} onChange={e => setFilters({...filters, entity: e.target.value})}>
                                <option value="">All Entities</option>
                                {ENTITIES.map(e => <option key={e} value={e}>{e}</option>)}
                            </select>
                            <select className="px-4 py-3 bg-slate-50 border-none rounded-xl font-bold text-sm outline-none"
                                value={filters.status} onChange={e => setFilters({...filters, status: e.target.value})}>
                                <option value="">All Statuses</option>
                                {STATUSES.map(s => <option key={s} value={s}>{s}</option>)}
                            </select>
                        </div>

                        {/* DATA TABLE */}
                        <div className="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse min-w-[1200px]">
                                    <thead>
                                        <tr className="bg-slate-50/50 text-[10px] font-bold text-slate-400 uppercase tracking-[0.15em]">
                                            <th className="p-5">Platform / Entity</th>
                                            <th className="p-5">Pack / Team</th>
                                            <th className="p-5">Connection / RDP</th>
                                            <th className="p-5">Details</th>
                                            <th className="p-5">Status</th>
                                            <th className="p-5 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 text-sm font-semibold">
                                        {filteredPacks.map(p => (
                                            <tr key={p.id} className="hover:bg-slate-50/50 transition-colors group">
                                                <td className="p-5">
                                                    <div className="text-blue-600 font-black">{p.entity}</div>
                                                    <div className="text-[10px] text-slate-400 uppercase">{p.platform}</div>
                                                </td>
                                                <td className="p-5">
                                                    <div className="text-slate-800 font-bold">{p.pack}</div>
                                                    <div className="text-[10px] text-slate-400">Team {p.team} • {p.localExternal}</div>
                                                </td>
                                                <td className="p-5">
                                                    <div className="font-mono text-xs text-slate-600 bg-slate-100 px-2 py-1 rounded inline-block mb-1">{p.server}</div>
                                                    <div className="text-[10px] text-slate-400 italic">{p.rdps} • {p.password}</div>
                                                </td>
                                                <td className="p-5">
                                                    <div className="font-black text-slate-700">{parseInt(p.countProfiles).toLocaleString()} Profs</div>
                                                    <div className="text-[10px] text-slate-400 uppercase">Disk: {p.disk} • {p.browser}</div>
                                                </td>
                                                <td className="p-5">
                                                    <span className={`px-3 py-1.5 rounded-lg text-[10px] font-black uppercase border ${
                                                        p.status === 'Repoting' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' :
                                                        p.status === 'DOWN' ? 'bg-rose-50 text-rose-600 border-rose-100' :
                                                        'bg-amber-50 text-amber-600 border-amber-100'
                                                    }`}>
                                                        {p.status}
                                                    </span>
                                                </td>
                                                <td className="p-5 text-right space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                                    <button onClick={() => setModal({ open: true, data: p })} className="w-9 h-9 text-blue-600 hover:bg-blue-50 rounded-xl transition-all"><i className="fas fa-pen-to-square"></i></button>
                                                    <button onClick={() => setPacks(prev => prev.filter(x => x.id !== p.id))} className="w-9 h-9 text-rose-600 hover:bg-rose-50 rounded-xl transition-all"><i className="fas fa-trash-can"></i></button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>

                    {/* FULL MODAL */}
                    {modal.open && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-md overflow-y-auto">
                            <div className="bg-white rounded-[2.5rem] shadow-2xl w-full max-w-2xl my-auto animate-in fade-in zoom-in duration-200">
                                <div className="px-10 py-8 border-b border-slate-100 flex justify-between items-center">
                                    <h2 className="text-2xl font-black text-slate-800 uppercase tracking-tighter">
                                        {modal.data ? 'Update Config' : 'New Installation'}
                                    </h2>
                                    <button onClick={() => setModal({open:false, data:null})} className="text-slate-300 hover:text-slate-900 text-2xl transition-colors">&times;</button>
                                </div>
                                <form onSubmit={handleSave} className="p-10 grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {[
                                        { n: 'entity', l: 'Entity', d: modal.data?.entity, t: 'text' },
                                        { n: 'pack', l: 'Pack Name', d: modal.data?.pack, t: 'text' },
                                        { n: 'server', l: 'Server IP', d: modal.data?.server, t: 'text' },
                                        { n: 'password', l: 'RDP Password', d: modal.data?.password, t: 'text' },
                                        { n: 'countProfiles', l: 'Profiles Count', d: modal.data?.countProfiles, t: 'number' },
                                        { n: 'rdps', l: 'RDP Identifier', d: modal.data?.rdps, t: 'text' }
                                    ].map(f => (
                                        <div key={f.n}>
                                            <label className="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 ml-1">{f.l}</label>
                                            <input name={f.n} type={f.t} defaultValue={f.d} required className="w-full px-5 py-3 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:bg-white transition-all font-bold" />
                                        </div>
                                    ))}
                                    <div className="md:col-span-2">
                                        <label className="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 ml-1">Current Status</label>
                                        <div className="flex flex-wrap gap-2">
                                            {STATUSES.map(s => (
                                                <label key={s} className="flex-1 min-w-[120px]">
                                                    <input type="radio" name="status" value={s} defaultChecked={modal.data?.status === s} className="hidden peer" />
                                                    <div className="text-center p-3 rounded-xl border border-slate-100 text-xs font-bold text-slate-400 peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 cursor-pointer transition-all">
                                                        {s}
                                                    </div>
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                    <button type="submit" className="md:col-span-2 mt-4 py-5 bg-blue-600 hover:bg-blue-700 text-white rounded-3xl font-black uppercase tracking-[0.2em] shadow-xl shadow-blue-200 transition-all active:scale-[0.98]">
                                        Confirm & Push Settings
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
